%% amsmath_lxir.sty
%% part of lxir - a tool to convert latex documents to xml.
%% Copyright 2007 EDP-Sciences
%
% This work may be distributed and/or modified under the
% conditions of the LaTeX Project Public License, either version 1.3
% of this license or (at your option) any later version.
% The latest version of this license is in
%   http://www.latex-project.org/lppl.txt
% and version 1.3 or later is part of all distributions of LaTeX
% version 2005/12/01 or later.
%
% This work has the LPPL maintenance status `maintained'.
%
% The Current Maintainer of this work is EDP-Sciences.
%
% This work consists of the files amsmath_lxir.sty.
% amsmath redefinie cette macro
\ifverbatimmath

\renewenvironment{equation}{\lxirvmathenv{equation}}{\endlxirvmathenv{equation}}
\renewenvironment{equation*}{\lxirvmathenvstar{equation-star}}{\endlxirvmathenvstar{equation-star}}
\renewenvironment{multline}{\lxirvmathenv{multline}}{\endlxirvmathenv{multline}}
\renewenvironment{multline*}{\lxirvmathenvstar{multline-star}}{\endlxirvmathenvstar{multline-star}}
\renewenvironment{gather}{\lxirvmathenv{gather}}{\endlxirvmathenv{gather}}
\renewenvironment{gather*}{\lxirvmathenvstar{gather-star}}{\endlxirvmathenvstar{gather-star}}
\renewenvironment{align}{\lxirvmathenv{align}}{\endlxirvmathenv{align}}
\renewenvironment{align*}{\lxirvmathenvstar{align-star}}{\endlxirvmathenvstar{align-star}}
\renewenvironment{flalign}{\lxirvmathenv{flalign}}{\endlxirvmathenv{flalign}}
\renewenvironment{flalign*}{\lxirvmathenvstar{flalign-star}}{\endlxirvmathenvstar{flalign-star}}
\renewenvironment{split}{\lxirvmathenv{split}}{\endlxirvmathenv{split}}
\renewenvironment{gathered}{\lxirvmathenv{gathered}}{\endlxirvmathenv{gathered}}
\renewenvironment{aligned}{\lxirvmathenv{aligned}}{\endlxirvmathenv{aligned}}
\else
\let\endmathdisplay@a=\relax
\def\@eqnnum{\xEmptyA{equationumber}{value=\theequation}}
\renewenvironment{equation}{%
  \incr@eqnum
  \mathdisplay@push
  \st@rredfalse \global\@eqnswtrue
  \xBegin{equation}
  \mathdisplay{equation}%
}{%
  \endmathdisplay{equation}%
  \xEmptyA{eqnnum}{value=\theequation}\xEnd{equation}
  \mathdisplay@pop
  \ignorespacesafterend
}
\renewenvironment{equation*}{%
  \mathdisplay@push
  \st@rredtrue \global\@eqnswfalse
  \xBegin{equation}
  \mathdisplay{equation*}%
}{%
  \endmathdisplay{equation*}%
  \xEnd{equation}
  \mathdisplay@pop
  \ignorespacesafterend
}
\renewenvironment{multline}{%
  \xBegin{multline}%
  \start@multline\st@rredfalse%
}{%
  \iftagsleft@ \@xp\lendmultline@ \else \@xp\rendmultline@ \fi
  \ignorespacesafterend
  \xEnd{multline}
}
\renewenvironment{multline*}{%
	\xBegin{multline-star}%
	\start@multline\st@rredtrue
}{%
	\endmultline
	\xEnd{multline-star}%
}
\renewenvironment{gather}{%
	\xBegin{gather}%
  \start@gather\st@rredfalse
}{%
  \math@cr \black@\totwidth@ \egroup
  $$\xEnd{gather} \ignorespacesafterend
}
\renewenvironment{gather*}{%
	\xBegin{gather-star}%
  \start@gather\st@rredtrue
}{%
  \endgather
	\xEnd{gather-star}%
}
\renewenvironment{align}{%
	\xBegin{align}%
  \start@align\@ne\st@rredfalse\m@ne
}{%
  \math@cr \black@\totwidth@
  \egroup
  \ifingather@
    \restorealignstate@
    \egroup
    \nonumber
    \ifnum0=`{\fi\iffalse}\fi
  \else
    $$%
  \fi
	\xEnd{align}%
  \ignorespacesafterend
}
\renewenvironment{align*}{%
	\xBegin{align-star}%
  \start@align\@ne\st@rredtrue\m@ne
}{%
  \endalign
	\xEnd{align-star}%
}
\frozen@everydisplay = {%
 	\xBegin{display}
	\check@mathfonts
	\the\everydisplay%
	\@displaytrue
	\aftergroup\Xenddisplay
	}%
\fi
